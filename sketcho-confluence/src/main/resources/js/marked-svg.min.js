"use strict";(function(){function t(t){this.tokens=[],this.tokens.links={},this.options=t||a.defaults,this.rules=h.normal,this.options.gfm&&(this.rules=this.options.tables?h.tables:h.gfm)}function e(t,e){if(this.options=e||a.defaults,this.links=t,this.rules=u.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?u.breaks:u.gfm:this.options.pedantic&&(this.rules=u.pedantic)}function n(t){this.tokens=[],this.token=null,this.options=t||a.defaults}function i(t,e){return t.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(t,e){return t=t.source,e=e||"",function n(i,s){return i?(s=s.source||s,s=s.replace(/(^|[^\[])\^/g,"$1"),t=t.replace(i,s),n):new RegExp(t,e)}}function r(){}function o(t){for(var e,n,i=1;i<arguments.length;i++){e=arguments[i];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}function a(e,s,r){if(r||"function"==typeof s){r||(r=s,s=null),s=o({},a.defaults,s||{});var l,p,h=s.highlight,u=0;try{l=t.lex(e,s)}catch(c){return r(c)}p=l.length;var d=function(){var t,e;try{t=n.parse(l,s)}catch(i){e=i}return s.highlight=h,e?r(e):r(null,t)};if(!h||h.length<3)return d();if(delete s.highlight,!p)return d();for(;u<l.length;u++)!function(t){return"code"!==t.type?--p||d():h(t.text,t.lang,function(e,n){return null==n||n===t.text?--p||d():(t.text=n,t.escaped=!0,--p||d(),void 0)})}(l[u])}else try{return s&&(s=o({},a.defaults,s)),n.parse(t.lex(e,s),s)}catch(c){if(c.message+="\nPlease report this to https://github.com/chjj/marked.",(s||a.defaults).silent)return"<p>An error occured:</p><pre>"+i(c.message+"",!0)+"</pre>";throw c}}function l(t){var e=markedToken.lexer(t),n=new markedToken.Parser;return n.parse(e)}function p(t){var e=new n;return e.parseHtml(t)}var h={justnewline:/^\n/,newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:r,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n|$)/,simplelist:/^([-*]{1,6}) +([^\n]+?)(?:\n|$)/,nptable:r,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:r,paragraph:/^((?:[^\n])+\n?)/,text:/^[^\n]+/};h.bullet=/(?:[*+-]|\d+\.)/,h.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,h.item=s(h.item,"gm")(/bull/g,h.bullet)(),h.list=s(h.list)(/bull/g,h.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),h._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",h.html=s(h.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,h._tag)(),h.paragraph=s(h.paragraph)("hr",h.hr)("heading",h.heading)("lheading",h.lheading)("blockquote",h.blockquote)("tag","<"+h._tag)("def",h.def)(),h.normal=o({},h),h.gfm=o({},h.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),h.gfm.paragraph=s(h.paragraph)("(?!","(?!"+h.gfm.fences.source.replace("\\1","\\2")+"|"+h.list.source.replace("\\1","\\3")+"|")(),h.tables=o({},h.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),t.rules=h,t.lex=function(e,n){var i=new t(n);return i.lex(e)},t.prototype.lex=function(t){return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(t,!0)},t.prototype.top=function(){return _.last(this.tokens)},t.prototype.token=function(t,e){for(var n,t=t.replace(/^ +$/gm,"");t;)if(n=this.rules.justnewline.exec(t))t=t.substring(n[0].length),this.tokens.push({type:"newline",text:"\n"});else if(n=this.rules.heading.exec(t))t=t.substring(n[0].length),this.tokens.push({type:"heading",depth:n[1].length,text:n[2]});else if(n=this.rules.lheading.exec(t))t=t.substring(n[0].length),this.tokens.push({type:"heading",depth:"="===n[2]?1:2,text:n[1]});else if(n=this.rules.simplelist.exec(t)){t=t.substring(n[0].length);var i=this.top(),s=n[1].length;i&&"list-item"===i.type?"list-item"===i.type&&s>i.depth?this.tokens.push({type:"list-nested"}):"list-item"===i.type&&s<i.depth&&this.tokens.push({type:"list-nested-end"}):this.tokens.push({type:"list-start"}),this.tokens.push({type:"list-item",depth:s,text:n[2]})}else if(e&&(n=this.rules.paragraph.exec(t)))t=t.substring(n[0].length),this.tokens.push({type:"paragraph",text:"\n"===n[0].charAt(n[0].length-1)?n[0].slice(0,-1):n[0]});else if(n=this.rules.text.exec(t))t=t.substring(n[0].length),this.tokens.push({type:"text",text:n[0]});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return this.tokens};var u={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:r,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,strong_legacy:/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:r,text:/^[\s\S]+?(?=[\\\[_*`]| {2,}\n|$)/};u._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,u._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,u.link=s(u.link)("inside",u._inside)("href",u._href)(),u.reflink=s(u.reflink)("inside",u._inside)(),u.normal=o({},u),u.pedantic=o({},u.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),u.gfm=o({},u.normal,{escape:s(u.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:s(u.text)("]|","~]|")("|","|https?://|")()}),u.breaks=o({},u.gfm,{br:s(u.br)("{2,}","*")(),text:s(u.gfm.text)("{2,}","*")()}),e.rules=u,e.output=function(t,n,i){var s=new e(n,i);return s.output(t)},e.prototype.output=function(t){for(var e,n=[];t;)if(e=this.rules.escape.exec(t))t=t.substring(e[0].length),n.push({text:e[1]});else if(e=this.rules.strong.exec(t))t=t.substring(e[0].length),n.push({bold:!0,text:e[2]||e[1]});else if(e=this.rules.strong_legacy.exec(t))t=t.substring(e[0].length),n.push({bold:!0,text:e[2]||e[1]});else if(e=this.rules.em.exec(t))t=t.substring(e[0].length),n.push({italic:!0,text:e[2]||e[1]});else if(e=this.rules.text.exec(t))t=t.substring(e[0].length),n.push({text:i(this.smartypants(e[0]))});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return n},e.prototype.outputHtml=function(t){var e="";return t.bold?"<strong>"+t.text+"</strong>":t.italic?"<i>"+t.text+"</i>":t.text?t.text:e},e.prototype.outputLink=function(t,e){return"!"!==t[0].charAt(0)?'<a href="'+i(e.href)+'"'+(e.title?' title="'+i(e.title)+'"':"")+">"+this.output(t[1])+"</a>":'<img src="'+i(e.href)+'" alt="'+i(t[1])+'"'+(e.title?' title="'+i(e.title)+'"':"")+">"},e.prototype.smartypants=function(t){return this.options.smartypants?t.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t},e.prototype.mangle=function(t){for(var e,n="",i=t.length,s=0;i>s;s++)e=t.charCodeAt(s),Math.random()>.5&&(e="x"+e.toString(16)),n+="&#"+e+";";return n},n.parse=function(t,e){var i=new n(e);return i.parse(t)},n.prototype.parse=function(t){this.inline=new e(t.links,this.options),this.tokens=t.reverse();for(var n=[];this.next();)n.push(this.tok());return n},n.prototype.parseHtml=function(t){this.inline=new e([],this.options),this.tokens=t.reverse();for(var n="";this.next();)n+=this.tokHtml();return n},n.prototype.next=function(){return this.token=this.tokens.pop()},n.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},n.prototype.parseText=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.output(t)},n.prototype.parseTextHtml=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.outputHtml(t)},n.prototype.tok=function(){switch(this.token.type){case"newline":return{type:"newline",items:[{text:"\n"}]};case"space":return"";case"hr":return"<hr>\n";case"heading":return{type:"heading",depth:this.token.depth,items:this.inline.output(this.token.text)};case"code":if(this.options.highlight){var t=this.options.highlight(this.token.text,this.token.lang);null!=t&&t!==this.token.text&&(this.token.escaped=!0,this.token.text=t)}return this.token.escaped||(this.token.text=i(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"blockquote_start":for(var e="";"blockquote_end"!==this.next().type;)e+=this.tok();return"<blockquote>\n"+e+"</blockquote>\n";case"list-start":return{type:"list-start"};case"list-nested":return{type:"list-nested"};case"list-nested-end":return{type:"list-nested-end"};case"list-item":return{type:"list-item",depth:this.token.depth,items:this.inline.output(this.token.text)};case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return{type:"paragraph",items:this.inline.output(this.token.text)};case"text":return"<p>"+this.parseText()+"</p>\n"}},n.prototype.tokenToHtml=function(){var t=this,e="";return _.each(this.token.items,function(n){e+="text"===n.type?t.parseTextHtml():t.inline.outputHtml(n)}),e},n.prototype.tokHtmlListStart=function(){var t="ul",e="";do{this.next(),("list-item"===this.token.type||"list-nested"===this.token.type)&&(e+=this.tokHtml());var n=this.peek(),i=!1;n&&"list-nested-end"===n.type&&(i=!0,this.next())}while((n&&"list-item"===n.type||n&&"list-nested"===n.type)&&!i);return"<"+t+">\n"+e+"</"+t+">\n"},n.prototype.tokHtml=function(){switch(this.token.type){case"newline":return"<br>\n";case"heading":return"<h"+this.token.depth+">"+this.tokenToHtml()+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var t=this.options.highlight(this.token.text,this.token.lang);null!=t&&t!==this.token.text&&(this.token.escaped=!0,this.token.text=t)}return this.token.escaped||(this.token.text=i(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"blockquote_start":for(var e="";"blockquote_end"!==this.next().type;)e+=this.tok();return"<blockquote>\n"+e+"</blockquote>\n";case"list-start":return this.tokHtmlListStart();case"list-nested":return'<li style="list-style-type:none">\n'+this.tokHtmlListStart()+"</li>\n";case"list-nested-end":return"";case"list-item":var e=this.tokenToHtml();return"<li>"+e+"</li>\n";case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return"<p>"+this.tokenToHtml()+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},r.exec=r,a.options=a.setOptions=function(t){return o(a.defaults,t),a},a.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},a.Parser=n,a.parser=n.parse,a.Lexer=t,a.lexer=t.lex,a.InlineLexer=e,a.inlineLexer=e.output,a.parse=a,a.parseTokens=l,a.parseHtml=p,"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):this.markedToken=a}).call(function(){return this||("undefined"!=typeof window?window:global)}()),function(){function t(t,e,n,i){this.rawNode=t,this.x=e,this.width=n,this.computeLength=i,this.svgNS="http://www.w3.org/2000/svg",this.dy=17,this.DEFAULT_LINE_MARGIN=5}function e(t){var e={size:12,topmargin:0,bottommargin:0};return _.has(r,t)&&(e=r[t]),e}function n(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}function i(e,n,i,s){return new t(e,n,i,s)}var s={newline:/\n/,skipSpaces:/^\s+(.*)/,justSpaces:/^\s*$/},r={1:{size:36,weigth:"bold",topmargin:26,bottommargin:8},2:{size:24,weigth:"bold",topmargin:14,bottommargin:3},3:{size:18,weigth:"bold",topmargin:8,bottommargin:2},4:{size:14,weigth:"bold",topmargin:4,bottommargin:1},5:{size:12,weigth:"bold",topmargin:2,bottommargin:0},6:{size:11,weigth:"bold",topmargin:1,bottommargin:0}};t.prototype.addTokens=function(t){var n=this,i=0;_.each(_.flatten(t),function(t){switch(t.type){case"paragraph":i=n.insertParagraph(t,i);break;case"heading":var s=e(t.depth);i=n.insertHeading(t,s,i+s.topmargin),i+=s.bottommargin;break;case"newline":i=n.insertNewLine(i);break;case"list-item":i=0==i?i:i+3,i=n.insertListItem(t,i)}})},t.prototype.insertParagraph=function(t,e){var n=this,i=!0,r={currentLineLength:0,tspan:null};return _.each(t.items,function(t){var o=!0,a=t.text.split(/\n/),l=_.map(a,function(t){return t.split(/(?=\s)/).concat(["\n"])}),p=_.initial(_.flatten(l));_.each(p,function(a){var l=!0;i?(r.tspan=n.newParagraph(t,e),r.currentLineLength=0,i=!1,o=!1):o?(s.justSpaces.exec(r.tspan.firstChild.nodeValue)?n.addAttributes(r.tspan,t):r.tspan=n.createTspan(t),o=!1):s.newline.exec(a)&&(r.tspan=n.newLine(t,n.dy),r.currentLineLength=0,l=!1),l&&(r=n.wordWrap(r,a,t))})}),this.dy},t.prototype.insertListItem=function(t,e){function n(t){return _.reduce(_.range(t),function(t){return t+o.nonBreakingSpace},o.nonBreakingSpace)}var i=this,s={currentLineLength:0,tspan:null},r=null,a=7,l=22,p=1==t.depth?a:a+(t.depth-1)*l;return _.each(t.items,function(t){s.tspan=i.createTspan(t);var e=t.text.split(/(?=\s)/);r||(r=s.tspan),_.each(e,function(e){s.dy=i.dy;var r=10;s.lessWidth=p+r,s=i.wordWrap(s,e,t),s.wrapped&&(s.tspan.setAttributeNS(null,"dx",p+1),s.tspan.firstChild.nodeValue=n(5)+s.tspan.firstChild.nodeValue)})}),r.setAttributeNS(null,"x",this.x),r.setAttributeNS(null,"dx",p),e&&e>0&&r.setAttributeNS(null,"dy",e),r.firstChild.nodeValue=o.bullet+n(3)+r.firstChild.nodeValue,this.dy},t.prototype.insertList=function(t){var e=this,n={currentLineLength:0,tspan:null};_.each(t.body,function(t){var i=null;_.each(t.items,function(s){n.tspan=e.createTspan(s),n.tspan.firstChild.nodeValue="newline"===t.type?o.nonBreakingSpace:s.text,i||(i=n.tspan)}),e.addNewLineAttributes(i,e.dy);var s="list_item_start"===t.type?"• ":"";i.firstChild.nodeValue=s+i.firstChild.nodeValue})};var o={nonBreakingSpace:" ",bullet:"●"};t.prototype.wordWrap=function(t,e,i){var r=t.tspan.firstChild,o=r.nodeValue.length,a=t.currentLineLength,l=this.getComputedTextLength(t.tspan);t.wrapped=!1,e=""===e?" ":n(e),r.nodeValue=r.nodeValue+e;var p=this.getComputedTextLength(t.tspan);t.currentLineLength=a-l+p;var h=this.width;if(t.lessWidth&&this.width-t.lessWidth>0&&(h=this.width-t.lessWidth),t.currentLineLength>h){if(r.nodeValue=r.nodeValue.substring(0,o),s.justSpaces.exec(r.nodeValue))this.addNewLineAttributes(t.tspan,this.dy),this.addAttributes(t.tspan,i);else{var u=t.dy?t.dy:this.dy;t.tspan=this.newLine(i,u)}t.tspan.firstChild.nodeValue=this.formatNewLine(e),t.currentLineLength=this.getComputedTextLength(t.tspan),t.wrapped=!0}return t},t.prototype.formatNewLine=function(t){var e=[];return(e=s.skipSpaces.exec(t))?e[1]:t},t.prototype.insertHeading=function(t,e,n){var i=this,s=!0,r={currentLineLength:0,tspan:null};return _.each(t.items,function(t){r.tspan=i.newTitle(t,e,n),s&&(r.tspan.setAttributeNS(null,"x",i.x),s=!1);var o=t.text.split(/(?=\s)/);_.each(o,function(s){r.dy=n+10,r=i.wordWrap(r,s,t),i.addTitleAttributes(r.tspan,e)})}),this.dy},t.prototype.insertNewLine=function(t){var e=this.newLine(null,t);return e.firstChild.nodeValue=o.nonBreakingSpace,t},t.prototype.newTitle=function(t,e,n){var i=this.createElementNSAndAddTspanWithText("");return n&&n>0&&i.setAttributeNS(null,"dy",n),this.addTitleAttributes(i,e),this.addAttributes(i,t),i},t.prototype.addTitleAttributes=function(t,e){t.setAttributeNS(null,"font-size",e.size),t.setAttributeNS(null,"font-weight","bold")},t.prototype.newParagraph=function(t,e){var n=null;return e&&e>0?n=this.newLine(t,e):(n=this.createElementNSAndAddTspanWithText(""),n.setAttributeNS(null,"x",this.x),this.addAttributes(n,t)),n},t.prototype.newLine=function(t,e){var n=this.createElementNSAndAddTspanWithText("");return this.addNewLineAttributes(n,e),this.addAttributes(n,t),n},t.prototype.addNewLineAttributes=function(t,e,n){t.setAttributeNS(null,"x",this.x),n&&n>0&&t.setAttributeNS(null,"dx",n),t.setAttributeNS(null,"dy",e)},t.prototype.createTspan=function(t){var e=this.createElementNSAndAddTspanWithText("");return this.addAttributes(e,t),e},t.prototype.addAttributes=function(t,e){e&&(e.bold&&t.setAttributeNS(null,"font-weight","bold"),e.italic&&t.setAttributeNS(null,"font-style","italic"))},t.prototype.newRow=function(t,e,n){return tspan_element=this.createElementNSAndAddTspanWithText(e),tspan_element.setAttributeNS(null,"x",n),tspan_element},t.prototype.boldif=function(t){t.bold&&tspan_element.setAttributeNS(null,"font-weight","bold")},t.prototype.getComputedTextLength=function(t){return""!==t.firstChild.nodeValue?this._getComputedTextLength(t):0},t.prototype._getComputedTextLength=function(t){return this.computeLength?this.computeLength(t):t.getComputedTextLength()},t.prototype.createElementNSAndAddTspanWithText=function(t){var e=window.document.createElementNS(this.svgNS,"tspan"),n=window.document.createTextNode(t);return e.appendChild(n),this.rawNode.appendChild(e),e},"object"==typeof exports?module.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):this.svgTextArea=i}.call(function(){return this||("undefined"!=typeof window?window:global)}());